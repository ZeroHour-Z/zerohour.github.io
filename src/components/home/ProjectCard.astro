---
import type { ImageMetadata } from 'astro'
import { Image } from 'astro:assets'

import { cn } from 'astro-pure/utils'

const {
  as: Tag = 'a',
  class: className,
  href,
  heading,
  subheading,
  imagePath,
  altText
} = Astro.props
const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/projects/*.{jpeg,jpg,png,gif,avif.webp}'
)
if (!images[imagePath])
  throw new Error(
    `"${imagePath}" does not exist in glob: "src/assets/projects/*.{jpeg,jpg,png,gif,avif.webp}"`
  )
---

<Tag
  class={cn(
    className,
    'project-card group overflow-hidden relative flex flex-col gap-y-3 bg-white aspect-square',
    href && 'transition-all hover:shadow-sm'
  )}
  href={href}
  target='_blank'
>
  <Image
    src={images[imagePath]()}
    alt={altText ?? heading}
    class='absolute top-0 h-full w-full object-cover transition-all'
    loading='lazy'
  />
  <!-- 深色叠加层 - 深色模式更暗，浅色模式保持明亮 -->
  <div class='absolute inset-0 bg-black/5 dark:bg-black/20 transition-all group-hover:bg-black/10 dark:group-hover:bg-black/55'></div>
  <div class='project-card-fg z-10 flex flex-col gap-y-1 px-3 sm:px-6 pb-3 sm:pb-6 transition-all opacity-0 group-hover:opacity-100 group-focus-within:opacity-100'>
    <h2 class='text-base sm:text-xl font-medium text-muted-foreground'>{heading}</h2>
    <p class='text-muted-foreground text-xs sm:text-base'>{subheading}</p>
  </div>
  <slot />
</Tag>

<style>
  .project-card-fg {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    --un-gradient-shape: to bottom in oklch;
    --un-gradient: var(--un-gradient-shape), var(--un-gradient-stops);
    --un-gradient-from-position: 0%;
    --un-gradient-from: transparent var(--un-gradient-from-position);
    --un-gradient-to-position: 40%;
    --un-gradient-to: hsl(var(--primary-foreground) / 0.9)
      var(--un-gradient-to-position);
    --un-gradient-stops: var(--un-gradient-from), var(--un-gradient-to);
    background-image: linear-gradient(var(--un-gradient));
  }

  .project-card:hover .project-card-fg,
  .project-card:focus-within .project-card-fg {
    --un-gradient-to-position: 60%;
  }

  /* 移动端触摸优化 */
  @media (max-width: 640px) {
    .project-card-fg {
      --un-gradient-to-position: 35%;
      padding-bottom: 0.75rem;
      padding-top: 2rem;
    }
    
    .project-card-fg h2 {
      font-size: 0.875rem;
      line-height: 1.25rem;
      margin-bottom: 0.25rem;
    }
    
    .project-card-fg p {
      font-size: 0.75rem;
      line-height: 1rem;
    }
  }
</style>
